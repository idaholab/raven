<Simulation verbosity='debug'>
  <!-- test info block -->

  <TestInfo>
      <name>framework/CodeInterfaceTests/AcceleratedCFD.perturbACFD</name>
      <author>alfoa</author>
      <created>2020-11-03</created>
      <classesTested>Models.Code.AcceleratedCFD</classesTested>
      <description>
          An example of using the AcceleratedCFD code interface.
          This test is aimed to test the mechanics of the interface (no executable).
      </description>
  </TestInfo>

  <!-- test info block end -->

  <RunInfo>
    <WorkingDir>AcceleratedCFDTest1</WorkingDir>
    <Sequence>testAcceleratedCFD,dumpResults</Sequence>
    <batchSize>1</batchSize>
  </RunInfo>

  <Files>
    <Input name="AcceleratedCFDinput" type="input">podInputs.xml</Input>
    <Input name="Cx" type="mesh-x">Cx</Input>
    <Input name="Cy" type="mesh-y">Cy</Input>
    <Input name="Cz" type="mesh-z">Cz</Input>
  </Files>

  <Models>
	<Code name="AcceleratedCFDCode" subType="AcceleratedCFD">
        <executable>./romRun</executable>
        <outputLocations>
            <x>0.0,1.0,min,max,average</x>
            <y>0.0,1.0,min,max,average</y>
            <z>0.0,1.0,min,max,average</z>
        </outputLocations>
        
    </Code>
  </Models>

  <Distributions>
    <UniformDiscrete name='numModes'>
      <lowerBound>10</lowerBound>
      <upperBound>30</upperBound>
      <strategy>withoutReplacement</strategy>
    </UniformDiscrete>
  </Distributions>

  <Samplers>
    <MonteCarlo  name="MC_samp">
      <samplerInit>
        <limit>2</limit>
      </samplerInit>
      <variable name='velMods'>
        <distribution>numModes</distribution>
      </variable>
      <variable name='scalMods'>
        <distribution>numModes</distribution>
      </variable>
    </MonteCarlo>
  </Samplers>

  <DataObjects>
    <PointSet name="AcceleratedCFDPointSet">
      <Input>velMods,scalMods</Input>
      <Output>time,volVectorField_x_0.0,
      volVectorField_y_0.0,
      volVectorField_z_0.0,
      volVectorField_x_1.0,
      volVectorField_y_1.0,
      volVectorField_z_1.0,
      volVectorField_x_min,
      volVectorField_y_min,
      volVectorField_z_min,
      volVectorField_x_max,
      volVectorField_y_max,
      volVectorField_z_max,
      volVectorField_x_average,
      volVectorField_y_average,
      volVectorField_z_average,
      volScalarField_x_0.0,
      volScalarField_x_1.0,
      volScalarField_x_min,
      volScalarField_x_max,
      volScalarField_x_average</Output>
    </PointSet>
    <HistorySet name="AcceleratedCFDHistorySet">
      <Input>velMods,scalMods</Input>
      <Output>time,volVectorField_x_0.0,
      volVectorField_y_0.0,
      volVectorField_z_0.0,
      volVectorField_x_1.0,
      volVectorField_y_1.0,
      volVectorField_z_1.0,
      volVectorField_x_min,
      volVectorField_y_min,
      volVectorField_z_min,
      volVectorField_x_max,
      volVectorField_y_max,
      volVectorField_z_max,
      volVectorField_x_average,
      volVectorField_y_average,
      volVectorField_z_average,
      volScalarField_x_0.0,
      volScalarField_x_1.0,
      volScalarField_x_min,
      volScalarField_x_max,
      volScalarField_x_average</Output>
    </HistorySet>
  </DataObjects>

  
  
  
  <OutStreams>
    <Print name="dumpAcceleratedCFDHistorySet">
      <type>csv</type>
      <source>AcceleratedCFDHistorySet</source>
    </Print>
    <Print name="dumpAcceleratedCFDPointSet">
      <type>csv</type>
      <source>AcceleratedCFDPointSet</source>
      <what>input,output</what>
    </Print>
  </OutStreams>

  <Steps>
	<MultiRun name="testAcceleratedCFD" clearRunDir="False">
        <Input   class="Files"       type="input">AcceleratedCFDinput</Input>
        <Input   class="Files"       type="mesh-x">Cx</Input>
        <Input   class="Files"       type="mesh-y">Cy</Input>
        <Input   class="Files"       type="mesh-x">Cz</Input>
        <Model   class="Models"      type="Code">AcceleratedCFDCode</Model>
        <Sampler class="Samplers"    type="MonteCarlo">MC_samp</Sampler>
        <Output  class="Databases"   type="HDF5">DataAcceleratedCFD</Output>
        <Output  class="DataObjects" type="HistorySet">AcceleratedCFDHistorySet</Output>
        <Output  class="DataObjects" type="PointSet">AcceleratedCFDPointSet</Output>
    </MultiRun>
    <IOStep name="dumpResults" >
        <Input   class="DataObjects" type="HistorySet">AcceleratedCFDHistorySet</Input>
        <Input   class="DataObjects" type="PointSet">AcceleratedCFDPointSet</Input>
        <Output class="OutStreams"   type="Print">dumpAcceleratedCFDHistorySet</Output>
        <Output class="OutStreams"   type="Print">dumpAcceleratedCFDPointSet</Output>
    </IOStep>
  </Steps>

  <Databases>
	<HDF5 name="DataAcceleratedCFD" readMode='overwrite' />
  </Databases>
</Simulation>
