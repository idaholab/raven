<?xml version="1.0" ?>
<Simulation verbosity="debug">
  <TestInfo>
    <name>framework/Samplers/ROM/tensorflow_keras.tf_mlpc</name>
    <author>cogljj</author>
    <created>2021-11-03</created>
    <classesTested>Models.ROM</classesTested>
    <description>
      Test the capability of multilayer perceptron regression (mlpr) using TensorFlow/Keras
      The data had an output of '=A2+2*B2-3*C2+D2*D2-E2+F2+G2-H2' generated by spreadsheet with the numbers comming from the classifier test.
      CustomSampler is used to convert the csv format data into PointSet, and it is also used to test the trained
      mlpc with the test data.
    </description>
  </TestInfo>

  <RunInfo>
    <WorkingDir>keras_mlp_regression</WorkingDir>
    <Sequence>CustomSampler,train,stats,resample,print</Sequence>
    <batchSize>1</batchSize>
  </RunInfo>

  <Files>
    <Input name="train.csv" type="">train.csv</Input>
    <Input name="test.csv" type="">test.csv</Input>
  </Files>

  <Samplers>
    <CustomSampler name="customSamplerFileTrain">
      <Source class="Files" type="">train.csv</Source>
      <variable name="x1"/>
      <variable name="x2"/>
      <variable name="x3"/>
      <variable name="x4"/>
      <variable name="x5"/>
      <variable name="x6"/>
      <variable name="x7"/>
      <variable name="x8"/>
      <variable name="y"/>
    </CustomSampler>
    <CustomSampler name="customSamplerFileTest">
      <Source class="Files" type="">test.csv</Source>
      <variable name="x1"/>
      <variable name="x2"/>
      <variable name="x3"/>
      <variable name="x4"/>
      <variable name="x5"/>
      <variable name="x6"/>
      <variable name="x7"/>
      <variable name="x8"/>
    </CustomSampler>
  </Samplers>

  <DataObjects>
    <PointSet name="trainingData">
      <Input>x1,x2,x3,x4,x5,x6,x7,x8</Input>
      <Output>y</Output>
    </PointSet>
    <PointSet name="outData">
      <Input>x1,x2,x3,x4,x5,x6,x7,x8</Input>
      <Output>y</Output>
    </PointSet>
    <PointSet name="dummyIN">
      <Input>x1,x2,x3,x4,x5,x6,x7,x8,y</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <PointSet name="dummyINTest">
      <Input>x1,x2,x3,x4,x5,x6,x7,x8</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <DataSet name="rom_stats"/>
  </DataObjects>

  <Steps>
    <MultiRun name="CustomSampler">
      <Input class="DataObjects" type="PointSet">dummyIN</Input>
      <Model class="Models" type="Dummy">MyDummy</Model>
      <Sampler class="Samplers" type="CustomSampler">customSamplerFileTrain</Sampler>
      <Output class="DataObjects" type="PointSet">trainingData</Output>
    </MultiRun>
    <MultiRun name="resample">
      <Input class="DataObjects" type="PointSet">dummyINTest</Input>
      <Model class="Models" type="ROM">modelUnderTest</Model>
      <Sampler class="Samplers" type="CustomSampler">customSamplerFileTest</Sampler>
      <Output class="DataObjects" type="PointSet">outData</Output>
    </MultiRun>
    <IOStep name="stats">
      <Input class="Models" type="ROM">modelUnderTest</Input>
      <Output class="DataObjects" type="DataSet">rom_stats</Output>
    </IOStep>
    <IOStep name="print">
      <Input class="DataObjects" type="PointSet">outData</Input>
      <Input class="DataObjects" type="DataSet">rom_stats</Input>
      <Output class="OutStreams" type="Print">outPrint</Output>
      <Output class="OutStreams" type="Print">romXML</Output>
    </IOStep>
    <RomTrainer name="train">
      <Input class="DataObjects" type="PointSet">trainingData</Input>
      <Output class="Models" type="ROM">modelUnderTest</Output>
    </RomTrainer>
  </Steps>

  <Models>
    <Dummy name="MyDummy" subType=""/>
    <ROM name="modelUnderTest" subType="KerasMLPRegression">
      <Features>x1,x2,x3,x4,x5,x6,x7,x8</Features>
      <Target>y</Target>
      <loss>mean_squared_error</loss>
      <batch_size>10</batch_size>
      <epochs>60</epochs>
      <plot_model>False</plot_model>
      <validation_split>0.25</validation_split>
      <random_seed>1986</random_seed>
      <Dense name="layer1">
          <dim_out>30</dim_out>
      </Dense>
      <Dense name="layer2">
          <dim_out>12</dim_out>
      </Dense>
      <Dense name="outLayer">
      </Dense>
      <layer_layout>layer1, layer2, outLayer</layer_layout>
    </ROM>
  </Models>

  <OutStreams>
    <Print name="outPrint">
      <type>csv</type>
      <source>outData</source>
      <filename>outMLPClassifier</filename>
      <what>input,output</what>
    </Print>
    <Print name="romXML">
      <type>csv</type>
      <source>rom_stats</source>
    </Print>
  </OutStreams>
</Simulation>
