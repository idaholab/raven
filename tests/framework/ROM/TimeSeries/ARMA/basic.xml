<?xml version="1.0" ?>
<Simulation verbosity="debug">
  <TestInfo>
    <name>framework/ROM/TimeSeries/ARMA.Basic</name>
    <author>alfoa</author>
    <created>2017-02-02</created>
    <classesTested>SupervisedLearning.ARMA</classesTested>
    <description>
       This test is aimed to check the possibility to train an ARMA+Fourier model and its
       capability to generate intrinsically stochastic time series
    </description>
    <revisions>
      <revision author="alfoa" date="2017-02-03">Adding this test description.</revision>
      <revision author="alfoa" date="2017-12-13">adapted for new DataObject structure</revision>
      <revision author="alfoa" date="2018-04-26">Modified location of the test (ARMA folder)</revision>
      <revision author="talbpaul" date="2018-06-14">Now tests history statistics instead of points</revision>
      <revision author="talbpaul" date="2018-12-20">Renamed from ARMA to Basic and added rom printing</revision>
      <revision author="wangc" date="2018-12-18">
          In PR #882, the standard errors on statistics moments are implemented, these quantities are stored in
          the pointwise metadata, and will be printed out in the output csv files by default.
          In order to avoid regolding this test, the optional node 'what' with text values 'input, output' is added.
          In this case, only the user requested variables as specified in the DataObjects are printed out.
      </revision>
      <revision author='talbpaul' date='2018-09-13'>changed Pmax and Pmin to P (same for Q)</revision>
    </revisions>
  </TestInfo>

  <RunInfo>
    <WorkingDir>Basic</WorkingDir>
    <Sequence>readIn, ARMATrain, printARMA, runARMA, writeOut, loadSynthetic, stats</Sequence>
    <batchSize>1</batchSize>
  </RunInfo>

  <Files>
    <Input name="rawDataFile">dataSet.csv</Input>
    <Input name="synDataFile">writeSynDataOut_0.csv</Input>
  </Files>

  <Distributions>
    <Uniform name="uniDist">
      <lowerBound>1</lowerBound>
      <upperBound>1.00001</upperBound>
    </Uniform>
  </Distributions>

  <Samplers>
    <MonteCarlo name="mcSampler">
      <samplerInit>
        <limit>1</limit>
        <initialSeed>20021986</initialSeed>
      </samplerInit>
      <variable name="scaling">
        <distribution>uniDist</distribution>
      </variable>
    </MonteCarlo>
  </Samplers>

  <Models>
    <ROM name="ARMA" subType="ARMA">
      <Target>Speed,Time</Target>
      <Features>scaling</Features>
      <pivotParameter>Time</pivotParameter>
      <outTruncation domain="positive">Speed</outTruncation>
      <Fourier>604800,86400</Fourier>
      <FourierOrder>2,2</FourierOrder>
      <P>2</P>
      <Q>1</Q>
    </ROM>
    <PostProcessor name="stats" subType="BasicStatistics">
      <expectedValue prefix="mean">Speed</expectedValue>
      <variance prefix="var">Speed</variance>
    </PostProcessor>
  </Models>

  <Steps>
    <IOStep name="readIn">
      <Input class="Files" type="">rawDataFile</Input>
      <Output class="DataObjects" type="HistorySet">rawData</Output>
    </IOStep>
    <RomTrainer name="ARMATrain">
      <Input class="DataObjects" type="HistorySet">rawData</Input>
      <Output class="Models" type="ROM">ARMA</Output>
    </RomTrainer>
    <IOStep name="printARMA">
      <Input class="Models" type="ROM">ARMA</Input>
      <Output class="DataObjects" type="DataSet">romMeta</Output>
      <Output class="OutStreams" type="Print">romMeta</Output>
    </IOStep>
    <MultiRun name="runARMA">
      <Input class="DataObjects" type="PointSet">dataIn</Input>
      <Model class="Models" type="ROM">ARMA</Model>
      <Sampler class="Samplers" type="MonteCarlo">mcSampler</Sampler>
      <Output class="DataObjects" type="HistorySet">synData</Output>
    </MultiRun>
    <IOStep name="writeOut" pauseAtEnd="True">
      <Input class="DataObjects" type="HistorySet">synData</Input>
      <Output class="OutStreams" type="Print">writeSynDataOut</Output>
      <Output class="OutStreams" type="Plot">plotSynData</Output>
    </IOStep>
    <IOStep name="loadSynthetic">
      <Input class="Files" type="">synDataFile</Input>
      <Output class="DataObjects" type="PointSet">asPoints</Output>
    </IOStep>
    <PostProcess name="stats">
      <Input class="DataObjects" type="PointSet">asPoints</Input>
      <Model class="Models" type="PostProcessor">stats</Model>
      <Output class="DataObjects" type="PointSet">stats</Output>
      <Output class="OutStreams" type="Print">stats</Output>
    </PostProcess>
  </Steps>

  <OutStreams>
    <Print name="writeSynDataOut">
      <type>csv</type>
      <source>synData</source>
      <what>input, output</what>
    </Print>
    <Print name="stats">
      <type>csv</type>
      <source>stats</source>
      <what>input,output</what>
    </Print>
    <Print name="romMeta">
      <type>csv</type>
      <source>romMeta</source>
    </Print>
    <Print name="romMeta">
      <type>csv</type>
      <source>romMeta</source>
    </Print>
    <Plot name="plotSynData" overwrite="false">
      <plotSettings>
        <plot>
          <type>line</type>
          <x>synData|Output|Time</x>
          <y>synData|Output|Speed</y>
          <interpPointsX>52560</interpPointsX>
        </plot>
      </plotSettings>
      <actions>
        <how>png</how>
      </actions>
    </Plot>
  </OutStreams>

  <DataObjects>
    <PointSet name="dataIn">
      <Input>scaling</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <PointSet name="asPoints">
      <Input>Time</Input>
      <Output>Speed</Output>
    </PointSet>
    <PointSet name="stats">
      <Output>mean_Speed,var_Speed</Output>
    </PointSet>
    <HistorySet name="rawData">
      <Input>scaling</Input>
      <Output>Speed,Time</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
    <HistorySet name="synData">
      <Input>scaling</Input>
      <Output>Speed,Time</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
    <DataSet name="romMeta"/>
  </DataObjects>

</Simulation>
